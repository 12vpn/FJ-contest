对于每个节点x，先处理出anc[x][y]，表示x的2^y祖先，再处理出lp[x][y]，表示所有在x的右边的深度为deep[x]+2^y的节点中最靠左的一个，rp[x][y]，表示所有在x的左边的深度为deep[x]+2^y的节点中最靠右的一个。按照bfs顺序给节点编号。每次发钱操作，通过类似于倍增求lca的方法求出x的子树中深度符合要求的节点中bfs顺序最大和最小的，再用树状树组差分区间加即可，每次查询时，输出所对应bfs顺序的前缀和即可。